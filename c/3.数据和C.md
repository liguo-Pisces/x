# 数据和C

## 变量与常量数据

在程序的指导下，计算机可以做许多事情。要完成这些任务，程序需要使用数据，即承载信息的数字和字符。有些数据类型在程序使用之前已经预先定义好了，在整个程序的运行过程中没有变化，这些称为常量（constant）。其他数据类型在程序运行期间可能会改变或被赋值，这些称为变量（variable）。

## 数据：数据类型关键字

C通过识别一些基本的数据类型来区分和使用这些不同的数据类型。如果数据是常量，编译器一般通过用户书写的形式来识别类型。但是，对变量而言，要在声明时指定其类型。

| 最初K&R给出的关键字 | C90标准添加的关键字 | C99标准添加的关键字 |
| ------------------- | ------------------- | ------------------- |
| int                 | signed              | _Bool               |
| long                | void                | _Complex            |
| short               |                     | _Imaginary          |
| unsigned            |                     |                     |
| char                |                     |                     |
| float               |                     |                     |
| double              |                     |                     |

在C语言中，用int关键字来表示基本的整数类型。后3个关键字（long、short和unsigned）和C90新增的signed用于提供基本整数类型的变式。char关键字用于指定字母和其他字符。另外，char类型也可以表示较小的整数。float、double和long double表示带小数点的数。\_Bool类型表示布尔类型，\_Complex和\_Imaginary分别表示复数和虚数。

通过这些关键字创建的类型，按计算机的储存方式可以分为两大基本类型：整数类型和浮点数类型。

## 整数和浮点数

### 整数

和数学的概念一样，在C语言中，整数是没有小数部分的数。计算机以二进制数字储存整数。

### 浮点数

浮点数与数学中实数的概念差不多。注意，在一个值后面加上一个小数点，该值就称为一个浮点值。书写浮点数有多种形式（e记数法）。

浮点数和整数的储存方案不同。计算机把浮点数分成小数部分和指数部分来表示，而且分开储存这两部分。

* 整数没有小数部分，浮点数有小数部分。
* 浮点数可以表示的范围比整数大。
* 对于一些算术运算，浮点数损失的精度更多。
* 因为在任何区间内都存在无穷多个实数，所以计算机的浮点数不能表示区间内所有的值。浮点数通常只是实际值的近似值。
* 过去，浮点运算比整数运算慢。不过，现在许多CPU都包含浮点处理器，缩小了速度上的差距。

## C语言基本数据类型

### int类型

int类型是有符号整型，即int类型的值必须是整数，可以是正整数、负整数或零。其取值范围依计算机系统而异。一般而言，存储一个int要占用一个机器字长。

声明int变量，先写上int，然后写变量名，最后加上一个分号。要声明多个变量，可以单独声明每个变量，也可在int后面列出多个变量名，变量名之间用逗号分隔。

```c
int erns;
int hogs, cows, goats;
```

以上声明创建了变量，但是并没有给它们提供值。

* 赋值。
* 通过函数获得值。
* 初始化变量。

初始化（initialize）变量就是为变量赋一个初始值。在C语言中，初始化可以直接在声明中完成。只需在变量名后面加上赋值运算符（=）和待赋给变量的值即可。

简而言之，声明为变量创建和标记存储空间，并为其指定初始值。

类似21、32这些整数都是整型常量或整型字面量。C语言把不含小数点和指数的数作为整数。

通常，C语言都假定整型常量是十进制数。然而，许多程序员很喜欢使用八进制和十六进制数。显然，八进制和十六进制记数系统在表达与计算机相关的值时很方便。在C语言中，用特定的前缀表示使用哪种进制。0x或0X前缀表示十六进制。与此类似，0前缀表示八进制。

要清除，使用不同的进制数是为了方便，不会影响数被储存的方式。也就是说，无论把数字写成16、020或0x10，存储该数的方式都相同，因为计算机内部都是以二进制进行编码。

在C程序中，既可以使用和显示不同进制的数。不同的进制要使用不同的转换说明。以十进制显示数字，使用`%d`；以八进制显示数字，使用`%o`；以十六进制显示数字，使用`%x`。另外，要显示各进制数的前缀0、0x和0X，必须分别使用`%#o`、`%#x`、`%#X`。

### 其他整数类型

C语言提供3个附属关键字修饰基本整数类型：short、long和unsigned。

* short int类型（或者简写为short）占用的存储空间可能比int类型少，常用于较小数值的场合以节省空间。与int类似，short是有符号类型。
* long int或long占用的存储空间可能比int多，适用于较大数值的场合。与int类似，long是有符号类型。
* long long int或long long（C99标准加入）占用的储存空间可能比long多，适用于更大数值的场合。该类型至少占64位。与int类似，long long是有符号类型。
* unsigned int或unsigned只用于非负值的场合。这种类型与有符号类型表示的范围不同。用于表示正负号的位现在用于表示另一个二进制位，所以无符号整型可以表示更大的数。
* 在C90标准中，添加了unsigned long int或unsigned long、unsigned int、unsigned short类型。C99标准中又添加了unsigned long long int或unsgined long long。
* 在任何有符号类型前面添加关键字signed，可强调使用有符号类型的意图。

其他整型类型的声明方式与int类型相同。

C语言只规定了short占用的存储空间不能多于int，long占用的存储空间不能少于int。这样规定是为了适应不同的机器。现在，计算机普遍使用64位处理器，为了存储64位的整数，才引入了long long类型。

现在，个人计算机上最常见的设置是，long long占64位，long占32位，short占16位，int占16位或32位（依计算机的自然字长而定）。原则上，这4种类型代表4种不同的大小，但是在实际使用中，有些类型之间通常有重叠。

通常，程序代码中使用的数字都被储存为int类型。如果数字超出了int类型能表示的范围，编译器会将其视为long int类型。如果数字超出long可表示的最大值，编译器则将其视为unsigned long类型。如果还不够大，编译器则将其视为long long或unsigned long long类型（前提是编译器能识别这些类型）。

八进制和十六进制常量被视为int类型。

有些情况下，需要编译器以long类型储存一个小数字。要把一个较小的常量作为long类型对待，可以在值得末尾加上l（小写的L）或L后缀。使用L后缀更好，因为l看上去和数字1很像。

类似地，在支持long long类型的系统中，也可以使用ll或LL后缀来表示long long类型的值。

溢出行为是未定义的行为，C标准并未定义有符号类型的溢出规则。

打印unsigned int类型的值，使用%u转换说明；打印long类型的值，使用%ld转换说明。如果系统中int和long的大小相同，使用%d就行。但是，这样的程序被移植到其他系统（int和long类型的大小不同）中会无法正常工作。在x和o前面可以使用l前缀，%lx表示以十六进制格式打印long类型整数，%lo表示以八进制格式打印long类型整数。注意，虽然C允许使用大写或小写的常量后缀，但是在转换说明中只能用小写。

### 使用字符：char类型

char类型用于存储字符，但是从技术层面看，char是整数类型。因为char类型实际上储存的是整数而不是字符。计算机使用数字编码来处理字符，即用特定的整数表示特定的字符。

C语言把1字节定义为char类型占用的位（bit）数，因此无论是16位还是32位系统，都可以使用char类型。

char类型变量的声明方式与其他类型变量的声明方式相同。

在C语言中，用单引号括起来的单个字符被称为字符常量（character constant）。编译器一发现`'A'`，就会将其转换成响应的代码值。单引号必不可少。

实际上，字符是以数值形式储存的，所以也可使用数字代码值来赋值。

C语言将字符常量视为int类型而非char类型。

单引号只适用于字符、数字和标点符号，浏览ASCII表会发现，有些ASCII字符打印不出来。C语言提供了3种方法表示这些字符。

* 使用ASCII码。例如，蜂鸣字符的ASCII值是7，因此可以这样写：`char beep = 7;`
* 使用特殊的符号序列表示一些特殊的字符。这些符号序列叫作转义序列（escape sequence）。把转义序列赋给字符变量时，必须用单引号把转义序列括起来。

| 转义序列 | 含义                                                         |
| -------- | ------------------------------------------------------------ |
| \a       | 警报（ANSI C）                                               |
| \b       | 退格                                                         |
| \f       | 换页                                                         |
| \n       | 换行                                                         |
| \r       | 回车                                                         |
| \t       | 水平制表符                                                   |
| \v       | 垂直制表符                                                   |
| \\\      | 反斜杠（\）                                                  |
| \\'      | 单引号                                                       |
| \\"      | 双引号                                                       |
| \\?      | 问号                                                         |
| \0oo     | 八进制（oo必须是有效的八进制数，即每个o可表示0~7中的一个数） |
| \xhh     | 十六进制（hh必须是有效的十六进制，即每个h可表示0~f中的一个数） |

* 从C90开始，不仅可以用十进制、八进制形式表示字符常量，C语言还提供了第三种选择 - 用十六进制形式表示字符常量，即反斜杠后面根一个x或X，再加上1~3位十六进制数字。

使用ASCII码时，注意数字和数字字符的区别。

使用%c指明带打印的字符。一个字符变量实际上被储存为1字节的整数值。因此，如果用%d转换说明打印char类型变量的值，打印的是一个整数。而%c转换说明打印该整数值对应的字符。

有些C编译器把char实现为有符号类型。而有些C编译器把char实现为无符号类型。根据C90标准，C语言允许在关键字char前面使用signed或unsigned。这样，无论编译器默认char是什么类型，signed char表示有符号类型，而unsigned char表示无符号类型。这在用char类型处理小整数时很有用。如果只用char处理字符，那么char前面无需使用任何修饰符。

### _Bool类型

C99标准添加了_Bool类型，用于表示布尔值，逻辑值true和false。

### 可移植类型：stdint.h和inttypes.h

C语言提供了许多有用的整数类型。但是，某些整型名在不同系统中的功能不一样。C99新增了两个头文件stdint.h和inttypes.h，以确保C语言的类型在各系统中的功能相同。

C语言为现有类型创建了更多类型名。这些新的类型名定义在stdint.h头文件中。

精确宽度整数类型（exact-width integer type）。int32_t表示整数类型的宽度正好是32位。但是，计算机的底层系统可能不支持。因此，精确宽度整数类型是可选项。

如果系统不支持精确宽度整数类型怎么办？C99和C11提供了第二类别名集合。一些类型名保证所表示的类型一定是至少有指定宽度的最小整数类型。这组类型集合被称为最小宽度类型（minimum width type）。

当然，一些程序员更关系速度而非空间。为此，C99和C11定义了一组可使计算达到最快的类型集合。这组类型集合被称为最快最小宽度类型（fastst minimum width type）。

C99和C11不仅提供可移植的类型名，还提供相应的输入和输出。提供了一些字符串宏来显示可移植类型。

### float、double和long double

各种整数类型对大多数软件开发项目而言够用了。然而，面向金融和数学的程序经常使用浮点数。C语言中的浮点类型有float、double和long double类型。浮点类型能表示包括小数在内更大范围的数。浮点数的表示类似于科学记数法。该记数系统常用于表示非常大或非常小的数。

指数记数法（或称为e记数法），这是科学记数法在计算机中的写法，e后面的数字代表10的指数。

C标准规定，float类型必须至少能表示6位有效数字，且取值范围至少是10^-37^ ~ 10^+37^。通常，系统储存一个浮点数要占用32位。其中8位用于表示指数的值和符号，剩下24位用于表示非指数部分（也叫尾数或有效数）及其符号。

C语言提供的另一种浮点类型是double（意为双精度）。double类型和float类型的最小取值范围相同，但至少必须能表示10位有效数字。

C语言的第三种浮点类型是long double，以满足比double类型更高的精度要求。不过，C只保证long double类型至少与double类型的精度相同。

浮点型变量的声明和初始化方式与整型变量相同。

在代码中，可以用多种形式书写浮点型常量。浮点型常量的基本类型是：有符号的数字（包括小数点），后面紧跟e或E，最后是一个有符号数表示10的指数。

`-1.56E+12`

`2.87e-3`

正号可以省略。可以没有小数点（`2E5`）或指数部分（19.28），但不能同时省略两者。可以省略小数部分（`3.E16`）或整数部分（`.45E-6`），但是不能同时省略两者。

不要在浮点型常量中间加空格。

默认情况下，编译器假设浮点型常量是double类型的精度。

在浮点数后面加上f或F后缀可覆盖默认设置，编译器会将浮点型常量看作float类型。使用l或L后缀使得数字成为long double类型。注意，建议使用L后缀，因为字母l和数字1很容易混淆。没有后缀的浮点型常量是double类型。

C99标准添加了一种新的浮点型常量格式 - 用十六进制表示浮点型常量，即在十六进制数前加上十六进制前缀（0x或0X），用p和P分别代替e和E，用2的幂代替10的幂（即，p计数法）。注意，并非所以的编译器都支持C99的这一特性。

使用%f转换说明打印十进制记数法的float和double类型浮点数，用%e打印指数记数法的浮点数。如果系统支持十六进制格式的浮点数，可用a和A分别代替e和E。打印long double类型要使用%Lf、%Le或%La转换说明。给那些未在函数原型中显示说明参数类型的函数传递参数时，C编译器会把float类型的值自动转换为double类型。

当计算导致数字过大，超过当前类型能表达的范围时，就会发生上溢（overflow）。这种行为在过去是未定义的，不过现在C语言规定，在这种情况下会给变量赋一个表示无穷大的特定值，而且printf()显示该值为inf或infinity（或者具有无穷含义的其他内容）。

C语言把损失了类型全精度的浮点值称为低于正常（subnormal）浮点值。下溢（underflow）。现在，C库已提供了用于检查计算是否会产生低于正常值得函数。

还有另一个特殊的浮点值NaN（not a number的缩写）。

### 复数和虚数类型

C11标准把整个复数软件包都作为可选项。

简而言之，C语言有3中复数类型：float_Complex、double_Complex和long double_Complex。类似地，C语言的3中虚数类型是float_Imaginary、double_Imaginary和long double_Imaginary。

如果包含complex.h头文件，便可用complex代替_Complex，用imaginary代替\_Imaginary，还可以用I代替-1的平方根。

为何C标准不直接用complex作为关键字来替换\_Complex，而要添加一个头文件（该头文件中把complex定义为\_Complex）？因为标准委员会考虑到，如果使用新的关键字，会导致以该关键字作为标识符的现有代码全部失效。

### 其他类型

虽然C语言没有字符串类型，但也能很好地处理字符串。

C语言还有一些从基本类型衍生的其他类型，包括数组、指针、结构和联合。

C Primer Plus P61

### 类型大小

sizeof是C语言的内置运算符，以字节为单位给出指定类型的大小。C99和C11提供%zd转换说明匹配sizeof的返回类型。一些不支持C99和C11的编译器可用%u或%lu代替%zd。

在limits.h和float.h头文件中有类型限制的相关信息。

## 使用数据类型

编写程序时，应注意合理选择所需的变量及其类型。在使用变量之前必须先声明，并选择有意义的变量名。初始化变量应使用与变量类型匹配的常量类型。

把一个类型的数值初始化给不同类型的变量时，编译器会直接转换成变量匹配的类型，这将导致部分数据丢失。

许多程序员和公司内部都有系统化的命名约定，在变量名中体现其类型。

## 参数和陷阱

程序员要负责确保转换说明的数量、类型与后面参数的数量、类型相匹配。现在，C语言通过函数原型机制检查函数调用时参数的个数和类型是否正确。但是，该机制对printf()和scanf()不起作用，因为这两个函数的参数个数可变。

## 转义序列示例

printf()何时把输出发送到屏幕上？最初，printf()语句把输出发送到一个叫缓冲区（buffer）的中间存储区域，然后缓冲区中的内容再不断被发送到屏幕上。C标准明确规定了何时把缓冲区中的内容发送到屏幕：当缓冲区满、遇到换行字符或需要输入的时候（从缓冲区把数据发送到屏幕或文件被称为刷新缓冲区）。

旧式编译器遇到scanf()也不会强行刷新缓冲区，程序会停在哪里不显示任何提示内容，等待用户输入数据。在这种情况下，可以使用换行字符刷新缓冲区。

## 关键概念

C语言提供了大量的数值类型，目的是为了程序员提供方便。那以整数类型为例，C认为一种整数不够，提供了有符号、无符号，以及大小不同的整数，以满足不同程序的需求。

计算机中的浮点数和整数在本质上不同，其存储方式和运算过程有很大区别。C语言允许编写混合数据类型的表达式，但是会进行自动类型转换，以便在实际运算时统一使用一种类型。

计算机在内存中用数值编码来表示字符。美国最常用的是ASCII码，除此之外C也支持其他编码。字符常量是计算机系统使用的数值编码的符号表示，它表示为单引号括起来的字符。

