#  字符串和格式化输入/输出

## 字符串简介

字符串（character string）是一个或多个字符的序列。

`"Zing went the strings of my heart!"`

双引号不是字符串的一部分。双引号仅告知编译器它括起来的是字符串，正如单引号用于标识单个字符一样。

### char类型数组和null字符

C语言没有专门用于储存字符串的变量类型，字符串都被储存在char类型的数组中。数组由连续的存储单元组成，字符串中的字符被储存在相邻的存储单元中，每个单元储存一个字符。

字符`\0`是空字符（null character），C语言用它标记字符串的结束。空字符不是数字0，它是非打印字符，其ASCII码值是（或等价于）0。C中的字符串一定以空字符结束，这意味着数组的容量必须至少比待存储字符串中的字符数多1。

那么，什么是数组？可以把数组看作是一行连续的多个存储单元。用更正式的说法是，数组是同类型数据元素的有序序列。

### 字符串和字符

字符串常量`"x"`和字符常量`'x'`不同。区别之一在于`'x'`是基本类型（char），而`"x"`是派生类型（char数组）；区别之二是`"x"`实际上由两个字符组成：`'x'`和空字符`\0`。

strlen与sizeof区别。

## 常量和C预处理器

符号常量（symbolic constant）。

那么，如何创建符号常量？方法之一是声明一个变量，然后将该变量设置为所需的常量。可以这样写：

```c
float taxrate;
taxrate = 0.015;
```

这样做提供了一个符号名，但是taxrate是一个变量，程序可能会无意间改变它的值。C语言还提供了一个更好的方案 - C预处理器。

```c
#define TAXRATE 0.015
```

编译程序时，程序中所有的TAXRATE都会被替换成0.015。这一过程被称为编译时替换（compile-time subsitution）。在运行程序时，程序中所有的替换均已完成。通常，这样定义的常量也称为明示常量（manifest constant）。

通用格式：`#define NAME value`

实际应用时，用选定的符号常量名和合适的值来替换NAME和value。注意，末尾不用加分号，因为这是一种由预处理器处理的替换机制。用大写表示符号常量是C语言一贯的传统。这样，在程序中看到全大写的名称就立刻明白这是一个符号常量，而非变量。大写常量只是为了提高程序的可读性，即使全用小写来表示符号常量，程序也能照常运行。

另外，还有一个不常用的命名约定，即在名称前带c\_或k\_前缀来表示常量。

符号常量的命名规则与变量相同。可以使用大小写字母、数字和下划线字符，首字符不能为数字。

\#define指令还可定义字符和字符串常量。前者使用单引号，后者使用双引号。

### const限定符

C90标准新增了const关键字，用于限定一个变量为只读。

`const int MONTHS = 12; // MONTH在程序中不可更改，值为12`

const用起来比\#define更灵活。

### 明示常量

C头文件limits.h和float.h分别提供了与整数类型和浮点类型大小限制相关的详细信息。每个头文件都定义了一系列供实现使用过的明示常量。

## printf()和scanf()

printf()函数和scanf()函数能让用户可以与程序交流，它们是输入/输出函数，或简称为I/O函数。

### printf()函数

请求printf()函数打印数据的指令要与待打印数据的类型相匹配。转换说明（conversion specification），它们指定了如何把数据转换成可显示的形式。

| 转换说明 | 输出                                                         |
| -------- | ------------------------------------------------------------ |
| %a       | 浮点数、十六进制数和p记数法（C99/C11）                       |
| %A       | 浮点数、十六进制数和p记数法（C99/C11）                       |
| %c       | 单个字符                                                     |
| %d       | 有符号十进制整数                                             |
| %e       | 浮点数，e记数法                                              |
| %E       | 浮点数，E记数法                                              |
| %f       | 浮点数，十进制记数法                                         |
| %g       | 根据值的不同，自动选择%f或%e。%e格式用于指数小于-4或者大于或等于精度时 |
| %G       | 根据值的不同，自动选择%f或%e。%e格式用于指数小于-4或者大于或等于精度时 |
| %i       | 有符号十进制整数（与%d相同）                                 |
| %o       | 无符号八进制整数                                             |
| %p       | 指针                                                         |
| %s       | 字符串                                                       |
| %u       | 无符号十进制整数                                             |
| %x       | 无符号十六进制整数，使用十六进制数0f                         |
| %X       | 无符号十六进制整数，使用十六进制数0F                         |
| %%       | 打印一个百分号                                               |

printf()函数的格式：

printf(格式字符串, 待打印项1,待打印项2,...);

待打印项1、待打印项2等都是要打印的项。它们可以是变量、常量，甚至是在打印之前先要计算的表达式。

### printf()的转换说明修饰符

在%和转换字符之间插入修饰符可修饰基本的转换说明。

| 修饰符 | 含义                                                         |
| ------ | ------------------------------------------------------------ |
| 标记   | 5种标记（-、+、空格、#和0），可以不使用标记或使用多个标记    |
| 数字   | 最小字段宽度。如果该字段不能容纳待打印的数字或字符串，系统会使用更宽的字段 |
| .数字  | 精度。对于%e、%E和%f转换，表示小数点右边数字的位数；对于%g和%G转换，表示有效数字最大位数；对于%s转换，表示待打印字符的最大数量；对于整型转换，表示待打印数字的最小位数；如果必要，使用前导0来达到这个位数；只使用.表示其后跟随一个0，所以%.f和%.0f相同 |
| h      | 和整型转换说明一起使用，表示short int或unsigned short int类型的值 |
| hh     | 和整型转换说明一起使用，表示signed char或unsigned char类型的值 |
| j      | 和整型转换说明一起使用，表示intmax_t或uintmax_t类型的值。这些类型定义在stdint.h中 |
| l      | 和整型转换说明一起使用，表示long int或unsigned long int类型的值 |
| ll     | 和整型转换说明一起使用，表示long long int或unsigned long long int类型的值（C99） |
| L      | 和浮点转换说明一起使用，表示long double类型的值              |
| t      | 和整型转换说明一起使用，表示ptrdiff_t类型的值。ptrdiff_t是两个指针差值的类型（C99） |
| z      | 和整型转换说明一起使用，表示size_t类型的值。size_t是sizeof返回的类型（C99） |

stddef.h头文件（咋包含stdio.h头文件时已包含其中）把size_t定义成系统使用sizeof返回的类型，这杯称为底层类型（underlying type）。

| 标记 | 含义                                                         |
| ---- | ------------------------------------------------------------ |
| -    | 待打印项左对齐。即，从字段的左侧开始打印该项项               |
| +    | 有符号值若为正，则在值前面显示加号；若为负，则在值前面显示减号 |
| 空格 | 有符号值若为正，则在值前面显示前导空格（不显示任何符号）；若为负，则在值前面显示减号;+标记覆盖一个空格 |
| #    | 把结果转换为另一种形式。如果是%o格式，则以0开始；如果是%x或%X格式，则以0x或0X开始；对于所有的浮点格式，#保证了即使后面没有任何数字，也打印一个小数点字符。对于%g和%G格式，#防止结果后面的0被删除。 |
| 0    | 对于数值格式，用前导0代替空格填充字段宽度。对于整数格式，如果出现-标记或指定精度，则忽略该标记。 |

### 转换说明的意义

转换说明把以二进制格式储存的计算机中的值转换成一系列字符（字符串）以便显示。

转换（conversion）可能会误导读者认为原始值被转替换成转换后的值。实际上，转换说明是翻译说明，%d的意思是“把给定的值翻译成十进制整数文本并打印出来”。

转换说明应该与待打印的类型相匹配。

别期望用%u转换说明能把数字和符号分开。

如果printf()语句有其他不匹配的地方，即使用对了转换说明也会生成虚假的结果。

printf()函数返回打印字符的个数。

字符串常量中有非法字符。在字符串中，可以使用\n来表示换行字符，但是不能通过按下Enter（或Return）键产生实际的换行符。

scanf()把输入的字符串转换成整数、浮点数、字符或字符串，而printf()正好与它相反，把整数、浮点数、字符和字符串转换成显示在屏幕上的文本。

printf()函数使用变量、常量和表达式，而scanf()函数使用指向变量的指针。

scanf()函数使用空白（换行符、制表符和空格）把输入分成多个字段。在依次把转换说明和字段匹配时跳过空白。唯一例外的是%c转换说明。根据%c，scanf()会读取每个字符，包括空白。

| 转换说明       | 含义                                                         |
| -------------- | ------------------------------------------------------------ |
| %c             | 把输入解释成字符                                             |
| %d             | 把输入解释成有符号的十进制整数                               |
| %e、%f、%g、%a | 把输入解释成浮点数（C99标准新增了%a）                        |
| %E、%F、%G、%A | 把输入解释成浮点数（C99标准新增了%A）                        |
| %i             | 把输入解释成有符号十进制整数                                 |
| %o             | 把输入解释成有符号八进制整数                                 |
| %p             | 把输入解释成指针（地址）                                     |
| %s             | 把输入解释成字符串。从第1个非空白字符开始，到下一个空白字符之前的所有字符都是输入 |
| %u             | 把输入解释成无符号十进制整数                                 |
| %x、%X         | 把输入解释成无符号十六进制整数                               |

转换说明修饰符

| 转换说明 | 含义                                                         |
| -------- | ------------------------------------------------------------ |
| *        | 抑制赋值，示例：`"%*d"`                                      |
| 数字     | 最大字段宽度。输入达到最大字段宽度处，或第1次遇到空白字符时停止 |
| hh       | 把整数作为signed char或unsigned char类型读取                 |
| ll       | 把整数作为long long或unsigned long long类型读取（C99）       |
| h、l或L  | `"%hd"`和`"%hi`"表明把对应的值存储为short int类型；`"%ho"`、`"%hx"`和`"%hu"`表明把对应的值储存为unsigned short int类型；`"%ld"`和`%li`表示把对应的值储存为long类型；`%lo`、`"%lx"`和`"%lu"`表示把对应的值储存为unsigned long类型；`"%le"`、`"%lf"`和`"%lg"`表明把对应的值储存为double类型；在e、f和g前面使用L而不是l，表明把对应的值被储存为long double类型。如果没有修饰符，d、i、o和x表明对应的值被储存为int类型，f和g表明把对应的值储存为float类型。 |
| j        | 在整型转换说明后面时，表示使用intmax_t或uintmax_t类型（C99） |
| z        | 在整型转换说明后面时，表明使用sizeof的返回类型（C99）        |
| t        | 在整型转换说明后面时，表示使用表示两个指针差值的类型（C99）  |

实际上，在C语言中scanf()并不是最常用的输入函数。这里重点介绍它是因为它能读取不同类型的数据。C语言还有其他的输入函数，如getchar()和fgets()。

scanf()函数允许把普通字符放在格式字符串中。除空格字符外的普通字符必须与输入字符串严格匹配。

scanf()会跳过整数前面的空白。

格式字符串中的空白意味着跳过下一个输入项前面的所有空白。请注意，“所有空白”的概念包括没有空格的特殊情况。

除了%c，其他转换说明都会自动跳过待输入值前面所有的空白。因此，`scanf("%d%d", &n, &m)`与`scanf("%d %d", &n, &m)`的行为相同。对于%c，在格式字符串中添加一个空格字符会有所不同。例如，如果把%c放在格式字符串中的空格前面，scanf()便会跳过空格，从第1个非空白字符开始读取。也就是说，`scanf("%c", &ch)`从输入中的第1个字符开始读取，而`scanf(" %c", &ch)`则从第1个非空白字符开始读取。

### printf()和scanf()的*修饰符

printf()和scanf()都可以使用\*修饰符来修改转换说明的含义。但是，它们的用法不太一样。首先，我们来看printf()的\*修饰符。

如果你不想预先指定字段宽度，希望通过程序来指定，那么可以用\*修饰符代替字符宽度。但还是要用一个阐述告诉函数，字段宽度应该是多少。也就是说，如果转换说明是`%*d`，那么参数列表中应包含\*和d对应的值。

scanf()中\*的用法与此不同。把\*放在%和转义字符之间，会使得scanf()跳过相应的输出项。

### printf()的用法提示

想把数据打印成列，指定固定字段宽度很有用。因为默认的字段宽度是待打印数字的宽度，如果同一列中打印的数字位数不同。

在两个转换说明之间插入一个空白符，可以确保即使一个数字溢出了自己的字段，下一个数字也不会紧跟该数字一起输出。这是因为格式字符串中的普通字符会被打印出来。

另一方面，如果要在文字中嵌入一个数字，通常指定一个小于或等于该数字宽度的字段会比较方便。这样，输出数字的宽度正合适，没有不必要的空白。

## 关键概念

C语言用char类型表示单个字符，用字符串表示字符序列。字符常量是一种字符串形式，即用双引号把字符括起来：`"Good luck, my friend"`。可以把字符串储存在字符数组（由内存中相邻的字节组成）中。字符串，无论是表示成字符常量还是储存在字符数组中，都以一个叫做空字符的隐藏字符结尾。

在程序中，最好用`#define`定义数值常量，用const关键字声明和变量为只读变量。在程序中使用符号常量（明示常量），提高了程序的可读性和可维护性。

C语言的标准输入函数（scanf()）和标准输出函数（printf()）都使用一种系统。在该系统中，第1个参数中的转换说明必须与后续参数中的值相匹配。对于scanf()，一定要记得在变量名前面加上地址运算符（&）。

空白字符（制表符、空格和换行符）在scanf()处理输入时起着至关重要的作用。除了%c模式（读取下一个字符），scanf()在读取输入时会跳过非空白字符前的所有空白字符，然后一直读取字符，直至遇到空白字符或与正在读取字符不匹配的字符。

## 本章小结

字符串是一系列被视为一个处理单元的字符。在C语言中，字符串是以空字符（ASCII码是0）结尾的一系列字符。可以把字符串储存在字符数组中。数组是一些列同类型的项或元素。下面声明了一个名为name、有30个char类型元素的数组：

`char name[30]`

要确保有足够的元素来储存整个字符串（包括空字符）。

字符串常量是用双引号括起来的字符序列，如：`"This is an example of a string"`。

scanf()函数（声明在string.h头文件中）可用于获得字符串的长度（末尾的空字符不计算在内）。scanf()函数中的转换说明是%s时，可读取一个单词。

C预处理器为预处理指令（以#符号开头）查找源代码程序，并在开始编译程序之前处理它们。处理器根据#include指令把另一个文件中的内容添加到该指令所在的位置。#define指令可以创建明示常量（符号常量），即代表常量的符号。limits.h和float.h头文件用#define定义了一组表示整型和浮点型不同属性的符号常量。另外，还可以使用const限定符创建定义后就不能修改的变量。

printf()和scanf()函数对输入和输出提供多种支持。另个函数都使用格式字符串，其中包含的转换说明表明待读取或待打印数据项的数量和类型。另外，可以使用转换说明控制输出的外观：字段宽度、小数位和字段内的布局。