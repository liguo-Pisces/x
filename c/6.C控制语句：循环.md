# C控制语句：循环

伪代码（pseudocode），是一种用简单的句子表示程序思路的方法，它与计算机语言的形式相对应。伪代码有助于设计程序的逻辑。确定程序的逻辑无误之后，再把伪代码翻译成实际的编程代码。使用伪代码的好处之一是，可以把注意力集中在程序的组织和逻辑上，不用在设计程序时还要分心如何用编程语言来表达自己的想法。

## while语句

while循环的通用形式如下：

```c
while (expression)
    statement
```

statement部分可以是以分号结尾的简单语句，也可以是用花括号扩起来的复合语句。

每次循环都被称为一次迭代（iteration）。

### 终止while循环

while循环有一点非常重要；在构建while循环时，必须让测试表达式的值有变化，表达式最终要为假。否则，循环就不会终止。

### 何时终止循环

要明确一点：只有在对测试条件求值时，才决定是终止还是继续循环。

### while：入口条件循环

while循环时使用入口条件的有条件循环。所谓“有条件”指的是语句部分的执行取决于测试表达式描述的条件。该表达式是一个入口条件（entry condition），因为必须满足条件才能进入循环体。

### 语法要点

使用while时，要牢记一点：只有在测试条件后面的单独语句（简单语句或复合语句）才是循环部分。

无限循环（infinite loop）。

空语句（null statement）。

## 用关系运算符和表达式比较大小

while循环经常依赖测试表达式作比较，这样的表达式被称为关系表达式（relational expression），出现的关系表达式中间的运算符叫做关系运算符（relational operator）。

while语句的关系表达式还可用于比较字符。比较时使用的是机器字符码（假定为ASCII）。但是，不能用关系运算符比较字符串。

虽然关系运算符也可用来比较浮点数，但是要注意：比较浮点数时，尽量只使用<和>。因为浮点数的舍入误差会导致在逻辑上应该相等的两数却不相等。

### 什么是真

对C而言，表达式为真的值是1，表达式为假的值是0。

### 其他真值

一般而言，所有的非零值都视为真，只有0被视为假。

如果待比较的一个值是常量，可以把该常量放在左侧有助于编译器捕获错误：

```c
5 = canoes # 语法错误
5 == canoes # 检查canoes的值是否为5
```

可以这样做是因为C语言不允许给常量赋值，编译器会把赋值运算符的这种用法作为语法错误标记出来。许多经验丰富的程序员在构建比较是否相等的表达式时，都习惯把常量放在左侧。

### 新的_Bool类型

在C语言中，一直用int类型的变量表示真/假值。C99专门针对这种类型的变量新增了\_Bool类型。在编程中，表示真或假的变量被称为布尔变量（Boolean variable），所以\_Bool是C语言中布尔变量的类型名。\_Bool类型的变量只能储存1（真）或0（假）。如果把其他非零数值赋给\_Bool类型的变量，该变量会被设置为1。这反映了C所有的非零值都视为真。

C99提供了stdbool.h头文件，该头文件让bool称为_Bool的别名，而且还把 true和false分别定义为1和0的符号常量。包含该头文件后，写出的代码可以以C++兼容，因为C++把bool、true、和false定义为关键字。

如果系统不支持\_Bool类型，导致无法运行该程序，可以把\_Bool替换成int即可。

### 优先级和关系运算符

| 运算符（优先级从高至低） | 结合律   |
| ------------------------ | -------- |
| ()                       | 从左往右 |
| - + ++ -- sizeof         | 从右往左 |
| * / %                    | 从左往右 |
| + -                      | 从左往右 |
| < > <= >=                | 从左往右 |
| == !=                    | 从左往右 |
| =                        | 从右往左 |

C Primer Plus P149

## 不确定循环和计数循环

一些while循环是不确定循环（indefinite loop）。所谓不确定循环，指在测试表达式为假以前，预先不知道要执行多少次循环。另外，还有一类计数循环（counting loop）。这类循环在执行循环之前就知道要重复执行多少次。

C Primer Plus P155

## 其他赋值运算符：+=、-=、*=、/=、%=

组合形式的赋值运算符，它们让代码更紧凑，而且与一般形式相比，组合形式的赋值运算符生成的机器代码更高效。

## 逗号运算符

逗号运算符并不局限于在for循环中使用，但是这是它最常用的地方。逗号运算符有两个其他性质。首先，它保证了被它分隔的表达式从左往右求值（换言之，逗号是一个序列点，所以逗号左侧项的所有副作用都在程序执行逗号右侧项之前发生）。

作为序列点的逗号保证了左侧子表达式的副作用在对右侧子表达式求值之前发生。

其次，整个逗号表达式的值是右侧项的值。

任何表达式后面加上一个分号就成了表达式语句。

逗号也可用作分隔符。

## 出口条件循环：do while

while循环和for循环都是入口条件循环，即在循环的每次迭代之前检查测试条件，所以有可能根本不执行循环体重的内容。C语言还有出口条件循环（exit-condition loop），即在循环的每次迭代之后检查测试条件，这保证了至少执行循环体重的内容一次。这种循环被称为do while循环。

下面是do while循环的通用形式：

```c
do
    statement
while (expression);
```

statement可以是一条简单语句或复合语句。注意，do while循环以分号结尾。

do while循环在执行完循环体后才执行测试条件，所以至少执行循环体一次；而for循环或while循环都是在执行循环体之前先执行测试条件。do while循环适用于那些至少要迭代一次的循环。

## 如何选择循环

如何选择使用哪一种循环？首先，确定是需要入口条件循环还是出口条件循环。通常，入口条件循环用得比较多，有几个原因，其一，一般原则是在执行循环之前测试条件比较好。其二，测试放在循环的开头，程序的可读性更高。另外，在许多应用中，要求在一开始不满足测试条件时就直接跳过整个循环。

那么，假设需要一个入口条件循环，用for循环还是while循环？这取决于个人喜好，因为两者皆可。

一般而言，当循环涉及初始化和更新变量时，用for循环比较合适，而在其他情况下用while循环更好。

## 嵌套循环

嵌套循环（nested loop）指在一个循环内包含另一个循环。嵌套循环常用于按行和列显示数据，也就是说，一个循环处理一行中的所有列，另一个循环处理所有的行。

外层循环（outer loop）

内层循环（inner loop）

### 嵌套变式

可以通过外层循环控制内层循环，在每次外层循环迭代时内层循环完成不同的任务。

## 数组简介

数组（array）是按顺序储存的一系列类型相同的值。整个数组由一个数组名，通过整数下标访问数组中单独的项或元素（element）。

实际上，使用数组元素和使用同类型的变量一样。

这里要注意一个潜在的陷阱：考虑到影响执行的速度，C编译器不会检查数组的下标是否正确。

用于识别数组元素的数字被称为下标（subscript）、索引（indice）或偏移量（offset）。下标必须是整数，而且要从0开始计数。数组的元素被依次储存在内存中相邻的位置。

模块化（modularity）的思想是：应该把程序划分为一些独立的单元，每个单元执行一个任务。这样做提高了程序的可读性。也许更重要的是，模块化使程序的不同部分彼此独立，方便后续更新或修改程序。

声明函数、调用函数、定义函数，使用关键字return，都是定义和使用带返回值函数的基本要素。

前置声明（forward declaration）

## 关键概念

循环是一个强大的编程工具。在创建循环时，要特别注意以下3个方面：

* 注意循环的测试条件要能使循环结束；
* 确保循环测试中的值在首次使用之前已初始化；
* 确保循环在每次迭代都更新测试的值；

C通过求值来处理测试条件，结果为0表示假，非0表示真。带关系运算符的表达式常用于循环测试，它们有些特殊。如果关系表达式为真，其值为1；如果为假，其值为0。这与新类型\_Bool的值保持一致。

数组由相邻的内存位置组成，只储存相同类型的数据。记住，数组元素的编号从0开始，所有数据最后一个元素的下标一定比元素数目少1。C编译器不会检查数组下标值是否有效，自己要多留心。

使用函数涉及3个步骤：

* 通过函数原型声明函数；
* 在程序中通过函数调用使用函数；
* 定义函数；

函数原型是为了方便编译器查看程序中使用的函数是否正确，函数定义描述了函数如何工作。现代的编程习惯是把程序要素分为接口部分和实现部分，例如函数原型和函数定义。接口部分描述了如何使用一个特性，也就是函数原型所做的；实现部分描述了具体的行为，也正是函数定义所做的。

## 本章小结

本章的主题是程序控制。C语言为实现结构化的程序提供了许多工具。while语句和for语句提供了入口条件循环。for语句特别适用于需要初始化和更新的循环。使用逗号运算符可以在for循环中初始化和更新多个变量。有些场合也需要使用出口条件循环，C为此提供了do while语句。

典型的while循环设计的伪代码如下：

``` c
获得初值
while (值满足测试条件)
{
    处理该值
    获取下一个值
}
```

for循环也可以完成相同的任务：

```c
for (获得初值; 值满足测试条件; 获得下一个值)
    处理该值
```

这些循环都使用测试条件来判断是否继续执行下一次迭代。一般而言，如果对测试表达式求值为非0，则继续执行循环；否则，结束循环。通常，测试条件都是关系表达式（由关系运算符和表达式构成）。表达式的关系为真，则表达式的值为1；如果关系为假，则表达式的值为0。C99新增了\_Bool类型，该类型的变量只能储存1或0，分别表示真或假。

除了关系运算符，本章还介绍了其他的组合赋值运算符，如+=或\*=。这些运算符通过对其左侧运算对象执行算术运算来修改它的值。

接下来还简单地介绍了数组。声明数组时，方括号中的值指明了该数组的元素个数。数组的第1个元素编号为0，第2个元素编号为1，以此类推。

利用循环可以很方便地控制数组的下标。

最后，本章演示了如何编写和使用返回值的函数。