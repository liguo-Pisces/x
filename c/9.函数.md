# 函数

如何组织程序？C的设计思想是，把函数用作构件块。

首先， 什么是函数？函数（function）是完成特定任务的独立程序代码单元。

为什么要使用函数？首先，使用函数可以省去编写重复代码的苦差。其次，即使程序只完成某项任务一次，也值得使用函数。

许多程序员喜欢把函数看作是根据传入信息（输入）及其生成的值或响应的动作（输出）来定义的“黑盒”。如果不是自己编写函数，根本不用关心黑盒的内部行为。

函数原型（function prototype）

函数调用（function call）

函数定义（function definition）

函数和变量一样，有多种类型。任何程序在使用函数之前都要声明该函数的类型。

一般而言，函数原型指明了函数的返回值类型和函数接受的参数类型。这些信息称为该函数的签名（signature）。

局部变量（local variable）

### 定义带形式参数的函数

函数定义从下面的ANSI C风格的函数头开始：

`void show_n_char(char ch, int num);`

该行告知编译器show_n_char()使用两个参数ch和num，ch是char类型，num是int类型。这两个变量被称为形式参数（formal argument，但是最近的标准推荐使用formal parameter），简称形参。和定义在函数中变量一样，形式参数也是局部变量，属该函数私有。这意味着在其他函数中使用同名变量不会引起名称冲突。每次调用函数，就会给这些变量赋值。

注意，ANSI C要求在每个变量前都声明其类型。也就是说，不能像普通变量声明那样使用同一类型的变量列表。

圆括号中只有参数名列表，而参数的类型的后面声明。注意，普通的局部变量在左花括号之后声明，而上面的变量在函数左花括号之前声明。如果变量时同一类型，这种形式可以用逗号分隔变量名列表。

```c
void dibs(x, y, z)
int x, y, z
```

当前的标准正逐渐淘汰ANSI之前的形式。读者应对此有所了解，以便能看懂以前编写的程序，但是自己编写程序时应使用现在的标准形式（C99和C11标准继续警告这些过时的用法即将被淘汰）。

### 声明带形式参数函数的原型

### 调用带实际参数的函数

在函数调用中，实际参数（actual argument，简称实参）。

被调函数（called function）

主调函数（calling function）

### 黑盒视角

黑盒里发生了什么对主调函数是不可见的。

### 使用return从函数中返回值

函数的返回值可以把信息从被调函数传回主调函数。

驱动程序（driver）

### 函数类型

声明函数时必须声明函数的类型。带返回值的函数类型应该与其返回值类型相同，而没有返回值的函数应声明为void类型。如果没有声明函数的类型，旧版本的C编译器会假定函数的类型是int。这一惯例源于C的早期，那时的函数绝大多数都是int类型。然而，C99标准不再支持int类型函数的这种假定设置。

要正确地使用函数，程序在第一次使用函数之前必须知道函数的类型。方法之一是，把完整的函数定义放在第一次调用函数的前面。然而，这种方法增加了程序的阅读难度。而且，要使用的函数可能在C库或其他文件中。因此，通常的做法是提前声明函数，把函数的信息告知编译器。

## ANSI C函数原型

针对参数不匹配的问题，ANSI C标准要求在函数声明时还要声明变量的类型，即使用函数原型（function prototype）来声明函数的返回类型、参数的数量和每个参数的类型。

错误和警告的区别是：错误导致无法编译，而警告仍然允许编译。一些编译器在进行类似的类型转换时不会通知用户，因为C标准中对此未作要求。不过，许多编译器都允许用户选择警告级别来控制编译器在描述警告时的详细程度。

### 无参数和未指定参数

一个支持ANSI C的编译器会假定用户没有用函数原型来声明函数，它将不会检查参数。为了表明函数确实没有参数，应该在圆括号中使用void关键字。

一些函数接受许多参数。对于这种情况，ANSI C允许使用部分原型。

`int printf(const char *, ...);`

C库通过stdarg.h头文件提供了一个定义这类（形参数量不固定的）函数的标准方法。

### 函数原型的有点

函数原型是C语言的一个强有力的工具，它让编译器捕获在使用函数时可能出现的许多错误或疏漏。

## 递归

C允许函数调用它自己，这种调用过程称为递归（recursion）。

结束递归是使用递归的难点，因为如果递归代码中没有终止递归的条件测试部分，一个调用自己的函数会无限递归。

可以使用循环的地方通常都可以使用递归。有时用循环解决问题比较好，但有时用递归更好。递归方案更简洁，但效率却没有循环高。

### 递归的基本原理

### 尾递归

最简单的递归形式是把递归调用置于函数的末尾，即正好在return语句之前。这种形式的递归被称为尾递归（tail recursion），因为递归调用在函数的末尾。尾递归是最简单的递归形式，因为它相当于循环。

既然用递归和循环来计算都没有问题，那么到底应该使用哪一个？一般而言，选择循环比较好。首先，每次递归都会创建一组变量，所以递归使用的内存更多，而且每次递归调用都会把创建的一组新变量放在栈中。递归调用的数量受限于内存空间。其次，由于每次函数调用要花费一定的时间，所以递归的执行速度较慢。

### 递归和倒序计算

递归在处理倒序时非常方便（在解决这类问题中，递归比循环简单）。

算法（algorithm）

### 递归的优缺点

递归既有优点也有缺点。优点是递归为某些编程问题提供了最简单的解决方案。缺点是一些递归算法会快速消耗计算机的内存资源。另外，递归不方便阅读和维护。

双递归（double recursion），即函数每一级递归都要调用本身两次。

## 编译多源代码文件的程序

目标代码文件

### 使用头文件

把函数原型和已定义的字符常量放在头文件中是一个良好的编程习惯。

## 查找地址：&运算符

指针（pointer）是C语言最重要的（有时也是最复杂的）概念之一，用于储存变量的地址。

一元&运算符给出变量的存储地址。可以把地址看作是变量在内存中的位置。

## 更改主调函数中的变量

## 指针简介

指针？什么是指针？从根本上看，指针（pointer）是一个值为内存地址的变量（或数据对象）。

要创建指针变量，先要声明指针变量的类型。

### 间接运算符：*

假设已知ptr指向bah，如下所示：

`ptr = &bah;`

然后使用间接运算符\*（indirection operator）找出储存在bah中的值，该运算符有时也称为解引用运算符（dereferencing operator）。不要把间接运算符和二元乘法运算符（\*）混淆，虽然它们使用的符号相同，但语法功能不同。

C Primer Plus P270

### 声明指针

类型说明符表明了指针所指向对象的类型，星号（\*）表明声明的变量时一个指针。`int *pi;`声明的意思是pi是一个指针，\*pi是int类型。

\*和指针名之间的空格可有可无。通常，程序员在声明时使用空格，在解引用变量时省略空格。

指针实际上是一个新类型，ANSI C专门为指针提供了%p格式的转换说明。

### 使用指针在函数间通信

#### 变量：名称、地址和值

编写程序时，可以认为变量有两个属性：名称和值（还有其他性质、如类型，暂不讨论）。计算机编译和加载程序后，认为变量也有两个属性：地址和值。地址就是变量在计算机内部的名称。

在许多语言中，地址都归计算机管，对程序员隐藏。然而在C中，可以通过&运算符访问地址，通过\*运算符获得地址上的值。

简而言之，普通变量把值作为基本量，把地址作为通过&运算符获得的派生量，而指针变量把地址作为基本量，把值作为通过\*运算符获得的派生量。

## 关键概念

如果想用C编出高效灵活的程序，必须理解函数。把大型程序组织成若干函数非常有用。甚至很关键。如果让一个函数处理一个任务，程序会更好理解，更方便调试。要理解函数时如何把信息从一个函数传递到另一个函数，也就是说，要理解函数参数和返回值的工作原理。另外，要明白函数形参和其他局部变量都属于函数私有，因此，声明在不同函数中的同名变量是完全不同的变量。而且，函数无法直接访问其他函数中的变量。这种限制访问保护了数据的完整性。但是，当确实需要在函数中访问另一个函数的数据时，可以把指针作为函数的参数。

## 本章小结

函数可以作为组成大型结构的构件块。每个函数都应该有一个单独且定义好的功能。使用参数把值传给函数，使用关键字return把值返回函数。如果函数返回的值不是int类型，则必须在函数定义和函数原型中指定函数的类型。如果需要在被调函数中修改主调函数的变量，使用地址或指针作为参数。

ANSI C提供了一个强大的工具 - 函数原型，允许编译器验证函数调用中使用的参数个数和类型是否正确。

C函数可以调用本身，这种调用方式被称为递归。一些编程问题要用递归来解决，但是递归不仅消耗内存多，效率不高，而且费时。

